# 캐릭터 이동 구현하기 (2025-05-20 ~ )
## 1. Global.gd 스크립트 파일로, 픽셀 단위를 곱해서 캐릭터를 타일 단위로 이동하게 구현하기
### <span style="background-color:#E6E6FA; color : black; font-weight : bold;">캐릭터 속도를 구현할 때 왜 픽셀 단위를 신경써야 되나요?</span>
- 우리가 캐릭터를 이동 시킬때는 속도 변수를 구현하고, 이를 토대로 캐릭터의 velocity 에 변수를 곱하거나 막 하는 식으로 구현한다.
- 고도 엔진의 <span style="background-color:#fff5b1; color : black; font-weight : bold;">2D 게임</span>에서 <span style="background-color:#fff5b1; color : black; font-weight : bold;">기본 단위</span>는 <span style="background-color:#fff5b1; color : black; font-weight : bold;">'픽셀'</span>이다.
- 그런데, 게임 타일맵을 살펴보면, <span style="background-color:#fff5b1; color : black; font-weight : bold;">타일 하나당 픽셀</span>이 <span style="background-color:#C0FFFF; color : black; font-weight : bold;">32 X 32</span> 이거나, <span style="background-color:#DCFFE4; color : black; font-weight : bold;">64 x 64</span> 등등 여러 가지 형식의 픽셀 단위가 존재한다.
- 우리가 조작할 캐릭터가 픽셀 단위로 움직이는 거가 속도를 구성하기 편할까
- 아니면, `타일 단위로 움직이게 속도를 구현하는 것이 편할까?`
- 우리는 속도에 타일 하나당의 픽셀 값을 곱해서, `캐릭터의 속도가 한 타일당 움직이도록 구현하는 디자인 패턴`을 사용해볼 것이다.

### 그러면, 구현해봅시다!
``` gdscript
# global.gd 스크립트 파일 내부 속
extends Node

# 전체 프로젝트에서 사용할 변수를 저장한 global.gd 스크립트 파일
# 이 스크립트 파일은, 프로젝트 설정에서 Global 항목 속에서 전역 변수로 사용될 것임.
# 즉, 게임이 시작되면 자동으로 선언될 전역 변수임
# ppt 변수는 Pixel per tile 뜻으로, 현재 게임 에셋은 타일 하나가 32 x 32 픽셀 사이즈로 구성되어 있다.
# 우리는 캐릭터가 한 타일당 움직이는 속도로 구성하고 싶다. 그러는게 더 편하다.
# 따라서, 전역 변수 ppt의 속성으로 32값을 넣었다.
# 만약, 타일이 64 X 64 픽셀이라면? 64 값을 넣으면 된다.
var ppt : int = 32

```
- 위 코드 속 int 자료형 변수 `ppt` 가 바로 `타일 하나당 픽셀의 개수를 저장할 변수`이다.
- 우리가 제작하는 2D 픽셀 플랫포머 게임의 `타일 하나당 픽셀의 개수는 32개` 이다. 즉 `32 X 32 픽셀의 타일`로 구성되어있다.
- 따라서, `ppt` 변수에 `32` 값을 넣는다.<br>
> ![](./제목%20없는%20동영상%20-%20Clipchamp로%20제작%20(1).gif)
> 1. 고도 엔진 프로그램 왼쪽 상단 `프로젝트` 버튼을 누른다.
> 2. `프로젝트 설정`을 누른다.
> 3. `Globals` 버튼을 누른다.
> 4. `경로 :` 부분에서 global.gd 스크립트 파일을 찾고 `+추가` 버튼을 클릭한다.
> 5.  전역변수 활성화 체크 박스가 체크 되어있는지 확인하고 창을 닫는다.
- 이후, 위 gif 파일의 작업을 통해서, global.gd 스크립트 파일을 전역 변수로 설정해놓는다.
- 위 작업을 통해, `Global.gd` 스크립트 파일 속, `ppt` 변수를 어디에서 사용할 수 있게 된다.

## 2. 이제, 캐릭터의 기본적인 뼈대를 구현해봅시다.
- 뼈대라고 한다면, 게임 속 캐릭터들이 모두 다 이 코드를 사용할 수 있도록 코드를 짜자는 이야기이다.
- 플레이어 캐릭터, 적 캐릭터1, 적 캐릭터2.... 등등 각각에 해당하는 픽셀 단위당의 이동과 점프에 대한 뼈대를 하나씩 만들게 되면, 굉장히 귀찮은 작업이 될 것이다.
- 따라서, 다음 기능들에 대한 뼈대인 character.gd 스크립트 파일을 만들고,
- 캐릭터들에 스크립트 파일을 넣는 식으로 구현하면 편할것이다.
> 1. 캐릭터의 속도, 가속, 감속 에 대한 값을 인스펙터 창에서 구현하도록 변수 선언
> 2. 캐릭터의 점프 속도에 대한 변수
> 3. 게임 시작시, 속도, 가속, 감속데 대한 값을 픽셀 단위에서 타일 단위로 변환
> 4. 플레이어 캐릭터 한정, 입력에 대한 방향 이동과 점프를 구현한 메서드
> 5. 매 프레임마다 캐릭터의 중력과 이동을 처리하는 메서드
>
- 정리해보니 기능이 엄청 많다. ㅋㅋㅋㅋㅋ
- 전체 코드를 아래에다가 작성해두겠다.
```GDScript
extends CharacterBody2D

# @export를 선언하여 인스펙터 창에서 조절 가능한 캐릭터 이동 설정값에 대한 변수를 선언한다.
# 따라서, @export 가 있는 변수들은, player.tscn 씬을 선택하면 오른쪽 인스펙터 창에서, 해당 변수들의 값을 조절할 수 있다.
@export var _speed : float = 8
# 가속을 나타내는 변수
@export var _acceleration : float = 16
# 감속을 나타내는 변수
@export var _deceleration : float = 32

# 캐릭터의 점프 속도에 대한 변수
const JUMP_VELOCITY = -400.0

var _direction : float

# gd 스크립트가 시작된다면? ppt 값을 곱해 실제 속도를 타일 단위로 변환한다.
func _ready():
	# _speed의 속도에 타일 하나당 픽셀 수를 곱해서 정상적인 속도를 준다.
	_speed *= Global.ppt
	# _acceleration의 속도에 타일 하나당 픽셀 수를 곱해서 정상적인 속도를 준다.
	_acceleration *= Global.ppt
	# _deceleration의 속도에 타일 하나당 픽셀 수를 곱해서 정상적인 속도를 준다.
	_deceleration *= Global.ppt

#region Public Methods

func face_left():
	pass
func face_right():
	pass

# 플레이어 입력에서 전달된 방향 (-1, 0, 1)을 _directino 에 저장한다.
func run(direction : float):
	# run 메서드로부터 받아온 direction 값을 _direction 값에 대입
	_direction = direction

func jump():
	# 캐릭터가 바닥에 있다면?
	if is_on_floor():
		# Y축 좌표로 JUMP_VELOCITY 만큼 속도를 준다. == 점프하게 한다.
		velocity.y = JUMP_VELOCITY
#endregion

# 매 프레임마다 중력/이동을 처리한다.
func _physics_process(delta: float) -> void:
	# 캐릭터가 바닥에 있지 않다면? (중력 처리)
	if not is_on_floor():
		# y축에 + 방향으로 중력을 줘서 캐릭터를 아래로 떨어뜨린다.
		velocity += get_gravity() * delta
		
	# return 해서 받아온 _direction 값이 0이라면? (이동처리)
	# 즉, 0으로 감소한다면
	if _direction == 0:
		# x축의 속도(velocity.x)를 = velocity.x(현재 값)값으로부터 0(목표값)까지 한번에 _deceleration * delta 값의 속도로 갈수 있다.
		# 즉, x축의 속도를 0으로 만들어버려 캐릭터의 움직임을 막는다.
		velocity.x = move_toward(velocity.x, 0, _deceleration * delta)
	# x 축 속도가 0이거나 _direction의 방향이 velocity.x의 방향과 동일하다면?
	# 즉, 움직이지 않았던 상태에서 가속하거나 || 같은 방향으로 계속 움직일러 한다면?
	elif velocity.x == 0 || sign(_direction) == sign(velocity.x):
		# 오른쪽, 또는 왼쪽을 결정하는 _direction 값 * _speed의 값으로 velocity.x 의 값을 _acceleration * delta 값의 속도로 이동한다.
		velocity.x = move_toward(velocity.x, _direction * _speed, _acceleration * delta)
	# 만약 반대 방향으로 이동할러고 한다면, 감속시킨다.
	else:
		velocity.x = move_toward(velocity.x, _direction * _speed, _deceleration * delta)
		
	# _physics_process 사용시 추가해야 될 코드 == 충돌 고려하여 이동을 처리한다.
	move_and_slide()
```
- 이곳 마크다운 문자에서 보기 힘들다면, 코드를 복사한 후, GDScript 에서 확인하면 될 것같다.
- 
